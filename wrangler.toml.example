# Copy to wrangler.toml for local deploy/rollback/log checks:
#   cp wrangler.toml.example wrangler.toml
#   source .env.local
#
# Security note:
# - Do not commit wrangler.toml (it is gitignored).
# - Keep account_id out of config.
# - Set CLOUDFLARE_ACCOUNT_ID in environment instead.
#
# Authoritative ops runbook:
# - docs/ops/cloudflare-deploy-runbook.md

name = "converttoit-site"
main = "cloudflare/worker/index.mjs"
compatibility_date = "2026-02-19"
workers_dev = true

[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
invocation_logs = true

[assets]
directory = "./dist"
binding = "ASSETS"

[[durable_objects.bindings]]
name = "GLOBAL_RATE_LIMITER"
class_name = "GlobalRateLimiter"

[[migrations]]
tag = "v1-global-rate-limiter"
new_sqlite_classes = ["GlobalRateLimiter"]

# Optional, not recommended (approximate + eventual consistency only):
# [[kv_namespaces]]
# binding = "GLOBAL_RATE_LIMIT_KV"
# id = "replace-with-your-kv-namespace-id"

[vars]
ENVIRONMENT = "production"
APP_VERSION = "0.0.0"
BUILD_SHA = "local"
RATE_LIMIT_GLOBAL_ENABLED = "false"
RATE_LIMIT_GLOBAL_MODE = "off"
RATE_LIMIT_GLOBAL_PROVIDER = "durable_object"
RATE_LIMIT_GLOBAL_DO_NAME = "global-rate-limiter-v1"
RATE_LIMIT_GLOBAL_DO_SHARDS = "32"
RATE_LIMIT_GLOBAL_TIMEOUT_MS = "50"
RATE_LIMIT_GLOBAL_FAIL_OPEN = "true"
RATE_LIMIT_GLOBAL_TELEMETRY_ENABLED = "false"
RATE_LIMIT_GLOBAL_ALLOW_KV_FALLBACK = "false"

[env.staging]
name = "converttoit-site-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
APP_VERSION = "0.0.0-staging"
BUILD_SHA = "local-staging"
RATE_LIMIT_GLOBAL_ENABLED = "false"
RATE_LIMIT_GLOBAL_MODE = "off"
RATE_LIMIT_GLOBAL_PROVIDER = "durable_object"
RATE_LIMIT_GLOBAL_DO_NAME = "global-rate-limiter-v1"
RATE_LIMIT_GLOBAL_DO_SHARDS = "32"
RATE_LIMIT_GLOBAL_TIMEOUT_MS = "50"
RATE_LIMIT_GLOBAL_FAIL_OPEN = "true"
RATE_LIMIT_GLOBAL_TELEMETRY_ENABLED = "false"
RATE_LIMIT_GLOBAL_ALLOW_KV_FALLBACK = "false"
